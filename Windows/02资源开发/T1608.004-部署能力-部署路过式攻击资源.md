# T1608-004-部署能力-部署路过式攻击资源

## 描述

攻击者可能准备一个操作环境，通过在用户正常浏览过程中访问恶意网站感染系统，实施路过式下载（Drive-by Compromise）攻击。用户的Web浏览器通常是攻击目标，访问攻击者控制的网站后通常无需额外用户交互即可触发漏洞利用。攻击者还可能为非漏洞利用行为设置网站，例如窃取应用程序访问令牌。实施路过式攻击前，攻击者需部署相关资源（如恶意脚本或内容），以向访问站点的用户提供漏洞利用。这些资源可能部署在攻击者控制的基础设施上，如已购买或租用的基础设施（获取基础设施T1583）或被入侵的基础设施（入侵基础设施T1584）。

攻击者可能通过以下方式部署恶意内容：
- 将恶意JavaScript或其他脚本注入网页、论坛帖子或其他用户可控制的内容。
- 通过合法广告提供商制作恶意网络广告并购买广告空间，嵌入到第三方网站。
- 部署脚本分析用户浏览器，收集主机信息（如浏览器版本、插件）以确认目标是否易受攻击。

被攻陷的网站可能是特定社区（如政府、行业或地区）常访问的站点，旨在针对具有共同兴趣或行为特征的用户群体，这种攻击常被称为战略性网络入侵或水坑攻击（Watering Hole Attack）。攻击者还可能注册与合法域名相似的域名（如同形文字、域名抢注或不同顶级域），以提升攻击的隐蔽性和可信度。

## 测试案例

暂无，仅提供辅助理解案例：

1. **水坑攻击部署恶意脚本**  
   攻击者将恶意JavaScript注入行业论坛网站，针对特定行业的用户，当用户访问论坛时，脚本利用浏览器漏洞（如CVE-2021-21224）执行恶意代码。

2. **恶意广告分发**  
   攻击者通过合法广告网络购买广告空间，嵌入恶意广告，诱导用户浏览器加载恶意内容，触发漏洞利用或收集用户凭据。(比如：银狐的经典手法)

## 检测日志

**无法有效监测**  
路过式攻击资源的部署通常发生在攻击者控制或第三方基础设施上，与目标系统无直接交互，因此难以通过日志直接检测。可能相关的日志来源包括：

- **网络日志**：与恶意网站或广告网络相关的异常HTTP/HTTPS流量（如异常的JavaScript请求）可能提供间接线索。
- **浏览器日志**：浏览器安全警告或异常脚本执行可能记录在客户端日志中。
- **安全软件日志**：EDR或防病毒工具可能记录浏览器漏洞利用或异常网络行为的尝试。

## 测试复现

无具体复现方法。  

## 测试留痕

无明显留痕。  

路过式攻击资源的部署通常不会在目标系统上留下直接痕迹。相关留痕可能出现在后续阶段，包括：

- **漏洞利用执行**：如果攻击触发浏览器漏洞，可能在系统日志或EDR中记录异常进程或内存操作。
- **网络活动**：与恶意网站或C2服务器的通信可能生成异常网络流量，记录在IDS/IPS或网络日志中。
- **浏览器行为**：异常脚本执行或浏览器崩溃可能触发客户端安全告警。

## 检测规则/思路

**检测规则**  
无明确的检测规则。

## 建议

### 缓解措施

由于路过式攻击资源的部署发生在企业防御和控制范围之外，难以通过预防性措施直接缓解。以下是一些建议：

1. **浏览器安全配置**  
   - 保持浏览器及插件（如Flash、Java）更新，修补已知漏洞。  
   - 禁用不必要的浏览器插件，降低攻击面。  
   - 示例：配置浏览器禁用JavaScript或启用沙箱模式。

2. **网络安全控制**  
   - 部署Web过滤器或代理，阻止访问可疑或未经授权的域名。  
   - 使用TLS解密设备检查加密流量，识别恶意脚本或内容。  

3. **用户教育**  
   - 培训用户识别可疑网站，避免访问不受信任的链接或论坛。  

4. **应用程序白名单**  
   - 部署应用程序白名单策略，限制未经授权的脚本或可执行文件运行。  

5. **系统加固**  
   - 启用浏览器安全功能，如地址空间布局随机化（ASLR）和数据执行保护（DEP）。  
   - 限制用户权限，减少漏洞利用导致的损害。

### 检测

由于此类活动通常在目标组织的可见性之外，检测工作应集中在攻击生命周期的后续阶段，包括但不限于：  
- **漏洞利用检测**：监控浏览器异常行为，如意外进程创建、内存操作或崩溃，识别潜在的路过式攻击。  
- **网络行为监控**：通过IDS/IPS或SIEM系统，关注与可疑域名或IP的异常HTTP/HTTPS流量。  
- **日志分析**：分析系统日志（如Windows事件ID 4688、5156）或浏览器日志，识别与漏洞利用或脚本执行相关的行为。  
- **威胁情报整合**：利用威胁情报平台，关联已知路过式攻击的IOC（如恶意域名、IP地址或脚本哈希）。

## 参考推荐

- MITRE ATT&CK: T1608-004  
  <https://attack.mitre.org/techniques/T1608/004/>