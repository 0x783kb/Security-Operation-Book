# T1590-001-收集目标组织网络信息-域属性

## 描述
攻击者在入侵目标组织之前，可能收集其网络域属性的信息。域属性信息包括目标组织拥有的域名、注册商信息、域名注册人联系方式（如姓名、电子邮件、电话）、公司地址、名称服务器（NS记录）、注册和到期日期等。这些信息可帮助攻击者了解目标的网络架构、关键联系人以及潜在的攻击入口点。

攻击者可能通过以下方式收集域属性信息：
- **被动收集**：查询公开的WHOIS数据库、DNS记录或其他技术数据库（如DNS Dumpster、Circl Passive DNS）。
- **主动收集**：通过扫描目标域的服务器（如端口扫描、Banner抓取）获取服务信息，或通过钓鱼诱导员工泄露域名管理凭据。
- **社会工程**：伪装成合法实体，通过邮件或电话套取域名管理相关信息。
- **公开信息分析**：利用搜索引擎、社交媒体或泄露文档（如Pastebin）获取与域名相关的信息。

收集到的域属性信息可能为后续攻击活动做准备，例如搜索开放网站/域（T1593）、主动扫描（T1595）、建立运营资源（T1583/T1584）或通过钓鱼攻击实现初始访问（T1566）。

## 测试案例
以下是模拟攻击者收集域属性信息的常见方法和工具：
- **WHOIS查询**：
  - **Kali Linux WHOIS**：使用命令行工具`whois target.com`查询域名注册信息。
  - **在线WHOIS查询工具**：
    - **站长之家** (<https://whois.chinaz.com>): 查询域名归属、注册商及到期时间。
    - **爱站网** (<https://whois.aizhan.com>): 提供域名注册信息和历史记录。
    - **IP138** (<https://www.ip138.com>): 查询域名和IP关联信息。
    - **ICANN Lookup** (<https://lookup.icann.org>): 官方WHOIS查询工具。
    - **腾讯云域名信息查询** (<https://cloud.tencent.com>): 查询域名注册详情。
    - **Whois Lookup** (<https://who.is>): 提供详细的WHOIS记录。
    - **新网WHOIS** (<https://www.xinnet.com>): 查询国内域名注册信息。
- **被动DNS与历史记录查询**：
  - **DNS Dumpster** (<https://dnsdumpster.com>): 获取域名关联的DNS记录和历史信息。
  - **SecurityTrails** (<https://securitytrails.com>): 查询域名的历史解析记录和子域名。
  - **Circl Passive DNS** (<https://www.circl.lu/services/passive-dns>): 提供全球DNS记录查询。
- **威胁情报平台**：
  - **微步在线** (<https://x.threatbook.cn>): 提供域名相关的威胁情报和注册信息。
  - **奇安信威胁情报平台** (<https://ti.qianxin.com>): 分析域名与潜在威胁的关联。
- **社会工程**：
  - 通过伪装成域名注册商发送钓鱼邮件，诱导员工泄露域名管理平台凭据。
  - 在社交媒体或论坛（如LinkedIn、QQ群）收集员工泄露的域名信息。
- **案例场景**：
  - 攻击者通过ICANN Lookup查询目标域名的注册人邮箱，发现其用于其他服务，发起针对性钓鱼攻击。
  - 使用SecurityTrails发现目标域名的历史NS记录，推测其托管服务提供商并寻找弱点。

## 检测日志
域属性信息收集多通过公开数据库或外部查询进行，难以直接监测。以下是可能的日志来源：
- **DNS服务器日志**：
  - 记录异常的DNS查询，如针对敏感域名的频繁WHOIS或NS查询。
- **Web服务器日志**：
  - 检测与域名管理平台相关的异常登录尝试或HTTP请求。
- **邮件服务器日志**：
  - 监控钓鱼邮件或社会工程攻击，可能与域名信息收集相关。
- **网络流量日志**：
  - 检测外部主机对组织DNS服务器的异常查询或扫描行为。

## 测试复现
暂无标准化复现流程。可通过以下方式模拟：
- **被动收集**：使用ICANN Lookup或SecurityTrails查询目标域名的WHOIS记录和历史DNS数据。
- **主动查询**：在授权测试环境中，使用`whois`命令或在线工具查询目标域名的注册信息。
- **社会工程模拟**：在红队测试中，伪装成注册商发送钓鱼邮件，诱导员工泄露域名管理凭据。
- **综合测试**：结合DNS Dumpster和Shodan，分析目标域名的子域名和关联资产。

## 测试留痕
- **被动WHOIS查询**：通常不留明显痕迹，难以直接检测。
- **主动扫描**：可能在DNS服务器或防火墙日志中记录异常查询或扫描流量。
- **社会工程**：可能在邮件服务器或员工设备上留下钓鱼交互记录。
- **域名管理平台**：异常登录尝试可能在管理平台日志中记录。

## 检测规则/思路
由于域属性信息收集多发生在目标组织视野之外，检测需结合多种手段：
- **DNS查询监控**：
  - 配置DNS服务器记录查询日志，检测异常的WHOIS或NS查询模式。
  - 使用DNS防火墙（如Cloudflare Gateway）阻止已知的恶意查询来源。
- **网络流量分析**：
  - 部署IDS/IPS（如Snort、Suricata）监控异常DNS查询或针对管理端口的扫描。
  - 使用Zeek或NetFlow分析DNS请求模式，识别潜在的枚举行为。
- **信息泄露防护**：
  - 使用DLP（数据丢失防护）工具，检测员工通过邮件或社交媒体泄露域名相关信息。
  - 监控公开信息源（如Pastebin、暗网论坛）中是否出现组织的WHOIS数据。
- **威胁情报整合**：
  - 结合威胁情报平台（如微步在线、奇安信），识别已知的WHOIS查询工具或恶意IP。
  - 定期检查公开WHOIS数据库中的记录，评估信息暴露风险。

## 建议
- **减少信息暴露**：
  - 使用WHOIS隐私保护服务，隐藏注册人联系方式和公司信息。
  - 定期审查公开DNS记录，删除不必要的子域名或敏感信息。
  - 对员工进行安全意识培训，防止通过社会工程泄露域名管理凭据。
- **域名安全加固**：
  - 启用域名注册锁，防止未经授权的域名转移。
  - 实施MFA（多因素认证）保护域名管理平台。
  - 定期更新DNS记录，移除过期的NS或A记录。
- **主动监控与响应**：
  - 部署DNS日志分析工具（如Splunk、ELK），监控异常查询行为。
  - 使用威胁狩猎（Threat Hunting）技术，主动搜索可能的域属性侦察活动。
  - 定期审计域名注册商和托管服务提供商的安全配置。
- **后续阶段检测**：
  - 重点监控攻击者生命周期的后续阶段（如初始访问T1566、横向移动T1021），通过异常网络流量或钓鱼行为间接发现侦察活动。

## 参考资料
- MITRE ATT&CK: T1590-003 (Domain Properties)  
  <https://attack.mitre.org/techniques/T1590/003/>
- 收集域名信息与安全  
  <https://www.kancloud.cn/noahs/src_hacker/2119907>
- 渗透测试之信息收集DNS篇  
  <https://blog.csdn.net/qq1124794084/article/details/78672225>