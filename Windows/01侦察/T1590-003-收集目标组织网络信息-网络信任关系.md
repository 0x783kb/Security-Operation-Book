# T1590-001-收集目标组织网络信息-网络信任关系

## 描述

攻击者在入侵目标组织之前，可能收集其网络信任关系的信息。网络信任关系信息包括与目标组织存在信任连接的第二方或第三方组织/域的详细信息，例如托管服务提供商、承包商、分公司或其他合作伙伴的网络访问权限。这些信任关系可能涉及专线连接、VPN、共享凭据或单点登录（SSO）系统，攻击者可利用这些关系实现初始访问或横向移动。

攻击者可能通过以下方式收集网络信任关系信息：
- **社会工程**：通过钓鱼邮件、电话伪装或社交媒体诱骗员工泄露信任关系信息。
- **公开信息收集**：查询公开技术数据库（如WHOIS、DNS记录）或搜索企业官网、社交媒体、招标文档等，获取与合作伙伴或供应商相关的信息。
- **网络侦察**：通过扫描或被动信息收集，识别目标组织与外部实体之间的网络连接（如专线、VPN端点）。
- **泄露数据分析**：利用暗网或公开泄露的数据集（如Pastebin、数据泄露论坛）获取信任关系信息。

收集到的信任关系信息可能为后续攻击活动做准备，例如主动扫描（T1595）、搜索开放网站/域（T1593）、建立运营资源（T1583/T1584）或利用信任关系实现初始访问（T1199）。

## 测试案例

以下是收集网络信任关系信息的常见方法和场景：
- **社会工程**：
  - 伪装成IT支持人员，通过钓鱼邮件诱导员工泄露VPN配置或第三方服务凭据。
  - 在LinkedIn、QQ群或行业论坛中与员工互动，套取与供应商或分公司的网络连接信息。
- **公开信息收集**：
  - 使用Google高级搜索语法（如`site:*.target.com "partner" | "supplier" | "contractor"`）查找目标组织与第三方合作的公开信息。
  - 查询WHOIS记录或DNS记录，识别与目标组织相关的子域或关联IP，推测信任关系。
  - 搜索公开招标文档或企业年报，获取与托管服务提供商或分公司的合作细节。
- **网络扫描**：
  - 使用Nmap或Masscan扫描目标组织的外部IP范围，识别VPN网关、远程访问服务或专线端点。
  - 使用Shodan或FOFA搜索与目标组织关联的外部设备，推测信任网络的边界。
- **案例场景**：
  - 在航空、金融或电信行业，攻击者可能通过入侵分公司的弱安全系统（如未打补丁的服务器），利用专线或共享凭据进入目标组织的内部网络。
  - 攻击者可能利用泄露的第三方托管服务提供商凭据（如云服务API密钥），通过信任关系访问目标组织的资源。

## 检测日志

网络信任关系信息的收集多发生在目标组织视野之外，检测难度较高。以下是可能的日志来源：
- **外部活动**：
  - **邮件服务器日志**：记录钓鱼邮件或异常的外部邮件交互。
  - **Web服务器日志**：检测异常的HTTP请求，可能与爬取公开信息相关。
  - **DNS日志**：监控针对组织域名的异常查询，可能是攻击者尝试推测信任关系。
- **内部活动**：
  - **VPN/远程访问日志**：记录异常的登录尝试或来自未知IP的连接。
  - **网络流量日志**：检测来自第三方网络的异常流量，可能与信任关系滥用相关。
  - **身份验证日志**：监控共享凭据或SSO系统的异常使用情况。

## 测试复现

暂无标准化复现流程。可通过以下方式模拟：
- **外部测试**：
  - 使用FOFA或Shodan搜索目标组织的VPN网关或远程访问服务，分析可能的信任关系。
  - 通过Google搜索或社交媒体收集与目标组织合作的第三方信息。
- **内部测试**：
  - 在授权测试环境中，模拟通过已攻陷的第三方系统（如分公司的服务器）尝试访问目标网络。
  - 使用Nmap扫描内网，识别与外部信任网络（如VPN或专线）相关的设备。
- **社会工程模拟**：
  - 在红队测试中，伪装成合作伙伴发送钓鱼邮件，诱导员工泄露信任关系信息。

## 测试留痕

- **社会工程**：可能在邮件服务器或员工设备上留下钓鱼邮件或交互记录。
- **外部扫描**：防火墙或IDS/IPS可能记录异常的扫描流量（如针对VPN端口的探测）。
- **公开信息收集**：通常不留明显痕迹，难以直接检测。
- **信任关系滥用**：可能在VPN或身份验证日志中记录异常的登录尝试或流量。

## 检测规则/思路
由于网络信任关系收集活动难以直接检测，建议从以下角度进行监控：
- **外部活动检测**：
  - 使用IDS/IPS（如Snort、Suricata）监控针对VPN、远程桌面或管理接口的异常扫描行为。
  - 配置WAF（Web应用防火墙）检测针对企业网站的异常爬取行为。
  - 监控DNS查询日志，识别针对组织域名的频繁或异常查询。
- **内部行为监控**：
  - 使用SIEM系统关联VPN、身份验证和网络流量日志，检测来自第三方网络的异常访问。
  - 部署EDR（端点检测与响应）工具，监控员工设备上的异常进程（如运行钓鱼邮件附件）。
- **信息泄露防护**：
  - 使用DLP（数据丢失防护）工具，检测员工通过邮件、网盘或社交媒体泄露信任关系信息。
  - 定期监控公开信息源（如Pastebin、暗网论坛）中是否出现与组织相关的信任关系数据。
- **威胁情报整合**：
  - 结合外部威胁情报，识别已知的恶意IP或钓鱼活动，关联可能的侦察行为。
  - 监控第三方合作伙伴的公开数据泄露事件，评估对自身信任关系的影响。

## 建议
- **减少信息暴露**：
  - 限制公开文档中与合作伙伴、供应商或分公司的网络连接信息。
  - 对员工进行安全意识培训，防止通过社交媒体或钓鱼泄露信任关系信息。
  - 使用WHOIS隐私保护服务，减少域名注册信息暴露。
- **网络安全加固**：
  - 实施强身份验证（如MFA）保护VPN、SSO或远程访问系统。
  - 配置网络分段，限制第三方网络对核心系统的直接访问。
  - 定期审计与第三方合作的网络连接（如专线、VPN），确保访问权限最小化。
- **主动监控与响应**：
  - 部署网络流量分析工具（如Zeek、NetFlow）监控与第三方网络的异常交互。
  - 使用威胁狩猎（Threat Hunting）技术，主动搜索可能的侦察或信任关系滥用行为。
  - 定期审查第三方合作伙伴的安全合规性，确保其网络安全措施达标。
- **后续阶段检测**：
  - 重点监控攻击者生命周期的后续阶段（如初始访问T1199、横向移动T1021），通过异常登录或网络流量间接发现侦察活动。

## 参考资料
- MITRE ATT&CK: T1590-001  
  <https://attack.mitre.org/techniques/T1590/001/>
- 渗透测试信息收集技术  
  <https://blog.csdn.net/weixin_45677119/article/details/110870703>
