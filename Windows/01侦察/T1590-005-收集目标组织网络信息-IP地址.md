# T1590-005-收集目标组织网络信息-IP地址

## 描述

攻击者可能在攻击前收集目标组织的IP地址信息，以了解其网络结构和基础设施。IP地址信息通常包括分配给目标组织的IP地址块、当前使用的IP地址范围等。这些信息可帮助攻击者推测目标的组织规模、地理位置、互联网服务提供商（ISP）以及面向公众的基础设施部署情况。

攻击者可能通过以下方式收集IP地址信息：
- **主动收集**：使用扫描工具（如Nmap、Masscan）或钓鱼技术。
- **被动收集**：查询公开技术数据库（如WHOIS、DNS Dumpster、Circl Passive DNS）或利用空间搜索引擎（如FOFA、ZoomEye）。
- **绕过CDN**：通过技术手段（如DNS历史记录查询）获取隐藏在CDN后的真实IP地址。

收集到的IP地址信息可能触发后续侦察活动，例如主动扫描（T1595）、搜索开放网站/域名（T1593）或建立运营资源（T1583/T1584），最终支持初始访问（如利用外部远程服务，T1133）。

## 测试案例

以下是收集IP地址信息的常见方法和工具：
- **网络扫描工具**：
  - **Nmap**：用于发现目标网络中的活跃IP地址和开放端口。
  - **Masscan**：高效扫描大规模IP地址范围。
  - **Goby**：自动化资产发现和漏洞扫描工具。
- **空间搜索引擎**：
  - **FOFA**：通过搜索特定IP地址或网络特征发现目标资产。
  - **ZoomEye**：提供全球IP地址和设备指纹的查询功能。
- **绕过CDN查找真实IP**：
  - 使用DNS历史记录查询工具（如SecurityTrails、DNS Dumpster）。
  - 参考方法：<https://blog.csdn.net/weixin_45677119/article/details/110870703>。

## 检测日志

由于IP地址信息收集多发生在目标组织网络外部（如通过公开数据库或扫描），传统日志难以有效监测。可能的日志来源包括：
- **DNS日志**：监控异常的DNS查询行为。
- **网络流量日志**：检测来自外部的扫描流量（如高频SYN包）。
- **Web服务器日志**：记录异常的HTTP请求，可能与钓鱼或探测相关。

## 测试复现

暂无标准化复现流程。攻击者通常结合主动扫描和被动查询完成IP地址收集，具体复现需根据目标环境模拟工具使用（如Nmap扫描或FOFA查询）。

## 测试留痕

- **主动扫描**：目标网络可能记录到异常的扫描流量（如来自单一IP的高频端口扫描）。
- **被动查询**：通常不留明显痕迹，难以直接检测。
- **CDN绕过**：可能在DNS查询日志中留下历史记录查询的痕迹。

## 检测规则/思路

由于IP地址收集活动多发生在目标组织视野之外，检测较为困难。以下是一些检测思路：
- **异常流量监控**：使用IDS/IPS（如Snort、Suricata）检测异常扫描行为，例如高频TCP/UDP连接尝试。
- **DNS查询分析**：监控异常的DNS查询模式，特别是针对组织域名的频繁查询。
- **威胁情报整合**：结合外部威胁情报，识别已知的恶意IP或扫描来源。
- **CDN日志分析**：若使用CDN，分析CDN日志中的异常请求，检测可能的IP泄露尝试。

## 建议

- **降低信息暴露**：
  - 限制WHOIS记录中的敏感信息（如联系方式）。
  - 使用CDN隐藏真实服务器IP地址。
  - 定期检查公开数据库中的IP信息泄露。
- **增强网络防御**：
  - 部署防火墙和IDS/IPS，限制未经授权的扫描流量。
  - 配置WAF（Web应用防火墙）以检测和阻止异常探测行为。
- **主动监控**：
  - 使用威胁情报平台跟踪针对组织的侦察活动。
  - 定期审计DNS记录和IP分配，防止泄露。
- **后续阶段检测**：
  - 重点监控攻击者生命周期的后续阶段（如初始访问T1133），通过异常登录或外部远程服务利用行为间接发现侦察活动。

## 参考推荐

- MITRE ATT&CK: T1590-005  
  <https://attack.mitre.org/techniques/T1590/005/>
- 渗透测试信息收集技术  
  <https://blog.csdn.net/weixin_45677119/article/details/110870703>